#### Домашнее задание Бэкапы

* 1) Создаем БД, схему и в ней таблицу. Заполним таблицы автосгенерированными 100 записями:
 >
 CREATE DATABASE backup;    
 CREATE TABLE products (  
    id SERIAL PRIMARY KEY,  
    name TEXT,  
    category TEXT,  
    price NUMERIC(10, 2)  
);    
 >
 INSERT INTO products (name, category, price)  
SELECT  
    'Product ' || generate_series(1, 100),  
    (ARRAY['Электроника', 'Одежда', 'Книги', 'Игрушки', 'Дом'])[(floor(random() * 5) + 1)::int],  
    round(random()::numeric, 2)  
FROM generate_series(1, 100);  

* 2) Под линукс пользователем postgres создадим каталог для бэкапов и назначим права:  
 >
 mkdir -p /var/backups/postgres  
 chown -R postgres:postgres /var/backups/postgres  
 chmod 700 "$postgres" 
 
* 3) Сделаем логический бэкап используя утилиту COPY
* бекап таблицы products в каталог /var/backups/postgres  с сохранением в csv файл с заголовками столбцов
 >
 sudo -u postgres psql -d backup -c "\copy products TO '/var/backups/postgres/products_backup.csv' WITH CSV HEADER"

* или бекап всей базы backup используя pg_dump
 >
  -u postgres pg_dump -d backup -C -U postgres -p 5434 > //var/backups/postgres/backup1.sql  
  
* 4) Восстановим в 2 таблицу данные из бэкапа  

* Для корректного восстановления, создаем таблицу products1 по аналогии с products:  
 >
 CREATE TABLE products (  
    id SERIAL PRIMARY KEY,  
    name TEXT,  
    category TEXT,  
    price NUMERIC(10, 2)  
);  
* Восстанавливаем данные:     
 >
 sudo -u postgres psql -d backup -c "\copy products1 FROM '/var/backups/postgres/products_backup.csv' WITH CSV HEADER"  
 (если восстанавливать в туже таблицу, которая содержит уникальные ограничения, или ключи, то возможны ошибки. В этом случае нужно очистить таблицу TRUNCATE TABLE products;)  
 
* 5) Используя утилиту pg_dump создадим бэкап в кастомном сжатом формате двух таблиц  
 >
 sudo -u postgres pg_dump -U postgres -d backup -t products -t products1 -F c -f /var/backups/postgres/backup_custom.dump  
  (Пример бекапа двух таблиц products и products1 с опцией -F c - сжатый, пригодный для восстановления)    
  
* 6) Используя утилиту pg_restore восстановим в новую БД только вторую таблицу!
* Создаем новую БД: 
 > 
 sudo -u postgres psql -c "CREATE DATABASE new_backup;"  
* Восстанавливаем вторую таблицу в новую бд new_backup:    
 > 
 sudo -u postgres pg_restore -U postgres -d new_backup -t products1 /var/backups/postgres/backup_custom.dump  
 
* Добавить данные в существующую таблицу (например, для обновления):
 >
 sudo -u postgres pg_restore --data-only --disable-triggers --no-owner -U postgres -d new_backup -t products1 /var/backups/postgres/backup_custom.dump
 
  