#### Домашнее задание - Работа с индексами

* 1) Создать индекс к какой-либо из таблиц вашей БД
* Создаем таблицу с данными:
 >
 CREATE TABLE products (  
    product_id SERIAL PRIMARY KEY,  
    name VARCHAR(100) NOT NULL,  
    category VARCHAR(50),  
    price NUMERIC(10, 2)  
 INSERT INTO products (name, category) VALUES ('телефон', 'электроника');  
);  

* Создаем индекс:  
>
  CREATE INDEX idx_products_category ON products (category);  
  
* 2) Прислать текстом результат команды explain, в которой используется данный индекс  
 >EXPLAIN SELECT * FROM products WHERE category = 'электроника';    
* Результат:
 > 
"Index Scan using idx_products_category on products  (cost=0.14..8.16 rows=1 width=356)"
"  Index Cond: ((category)::text = 'электроника'::text)"
* Пояснение:  
 Index Scan — использование индекса idx_products_category для поиска по таблице products    
 cost — оценка стоимости выполнения запроса, начальная стоимость 0.14, общая — 8.16, чем ниже — тем быстрее предполагается выполнение.    
 rows — предполагаемое количество строк, которые будут возвращены  
 width — средний размер строки в байтах  
 Index Cond — условие поиска, ищутся строки, где category равно 'электроника'    

* 3) Реализовать индекс для полнотекстового поиска      

* Добавляем колонку для tsvector и обновляем данные:    
 >  
 ALTER TABLE products ADD COLUMN tsv tsvector;  
 UPDATE products SET tsv = to_tsvector('russian', name || ' ' || category);    
 
* Создаем индекс:  
 >
 CREATE INDEX idx_products_tsv ON products USING GIN (tsv);
 
* Использование поиска:
 SELECT * FROM products WHERE tsv @@ to_tsquery('russian', 'телефон');
 (поиск товара содержащего слово телефон)
 
* 4) Реализовать индекс на часть таблицы или индекс на поле с функцией  

* Используем частичный индекс для ускорения запросов в категории электроника:  
 >
 CREATE INDEX idx_products_electronics ON products (name)
 WHERE category = 'Электроника';
 
* Используем функциональный индекс для поиска без учета регистра:  
 >
 CREATE INDEX idx_products_lower_name ON products (lower(name));
 
* 5) Создаем индекс на 2 поля:  
 >
 CREATE INDEX idx_products_all_fields ON products (name, category, price);    
 
 Примеры запросов:
 >
 SELECT * FROM products WHERE category = 'электроника' AND name LIKE '%телефон%';  
 
SELECT * FROM products  
ORDER BY category ASC, name ASC, price DESC;  

* Результат:
"product_id","name","category","price","tsv"
1,"телефон","электроника",NULL,"'телефон':1 'электроник':2"
 
________________
Скрипкин А.В.

