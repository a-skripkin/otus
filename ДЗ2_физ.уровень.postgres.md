### Домашнее задание - Физический уровень PostgreSQL

#### Задания:

1) Перенесите содержимое /var/lib/postgres/17 в /mnt/data - ```mv /var/lib/postgresql/17/mnt/data```
* Ответ: После переноса каталога с Postgres на примантированный диск и попытки запуска сервиса,  видно что main.service не запущен, т.к. в файлах конфигураций указан другой путь, откуда был скопирован каталог с рабочими файлами
* Проверить службу - ```systemctl status postgresql```
* Проверить зависимости после запуска сервиса - ```systemctl list-dependencies postgresql```

2) Найти конфигурационный параметр в файлах раположенных в /etc/postgresql/17/main который надо поменять и поменяйте его.  
* Ответ: находим файл конфигурации по пути - /etc/postgresql/17/main/postgresql.conf, 
* в блоке "FILE LOCATIONS" изменил путь на новый, в который была перемещена директория с рабочими файлами postgres, 
    было /var/lib/postgresql/17  - стало /mnt/backup/17  
* Сервер запустился, таблица на месте, все работает.  
-- Онлайн конфигуратор конфига - https://pgconfigurator.cybertec.at/
 
3. Не удаляя существующий инстанс ВМ сделайте новый, поставьте на него PostgreSQL, удалите файлы с данными из /var/lib/postgres, перемонтируйте внешний диск который сделали ранее от первой виртуальной машины ко второй и запустите PostgreSQL на второй машине так чтобы он работал с данными на внешнем диске, расскажите как вы это сделали и что в итоге получилось.
#### Решение:
* Создаю вторую ВМ, устанавливаю postgres
* Правлю конфиг для возможности подключения с удаленных адресов
* На второй машине удаляю /var/lib/postgres/17
* Выключил первую ВМ
* Отключаю примонтрованный vhdx диск и копирую в папку со второй ВМ (не обязательно, можно на второй машине указать путь к диску, но убедиться, что диск не занят)
* Подключил второй диск ко второй машине
* Проверяю виден ли диск в системе ``` lsblk -a или fdisk -l | grep /dev/sd  -- диск виден ```
* Смотрю UUID через blkid, прописываю в fstab UUID mnt/backup ext4 defaults 0 1
* Перезагружаюсь, проверяю что диск не отвалился
* Назначаю права postgres на /mnt/backup - ``` chown -R postgres:postgres /mnt/backup ```
* Изменяю путь к рабочим файлам postgres - /etc/postgresql/17/main/postgresql.conf, в блоке "FILE LOCATIONS" меняю путь на /mnt/backup/17/main
* Перезапускаю и проверяю работу postgres systemctl restart postgresql  status
* Все работает, таблица на месте !
______________
Скрипкин А.В.